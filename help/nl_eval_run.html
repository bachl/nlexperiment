<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Help</title>

<script src="../libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="../libs/bootstrap-3.3.1/css/spacelab.min.css" rel="stylesheet" />
<script src="../libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="../libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="../libs/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="../libs/highlight/default.css"
      type="text/css" />
<script src="../libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="../tufterhandout2.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header navbar-left">
      <!--a class="navbar-brand" href="../index.html">nlexperiment</a-->
      <a class="navbar-brand" href="../index.html">
        <!--img class="img-responsive" src="img/logo.png"-->
        <strong><nl>nl</nl><experiment>experiment</experiment></strong>
      </a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="../tutorial" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Getting Started<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li><a href="../tutorial.html">Overview</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Measures</li>
             <li><a href="../fire.html">Fire Experiment</a></li>
             <li><a href="../segregation.html">Segregation</a></li>
             <li><a href="../network.html">Network</a></li>
             <li><a href="../traffic.html">Traffic</a></li>
             <li><a href="../dla.html">DLA</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Parameter Value Sets</li>
             <li><a href="../ants.html">Ants</a></li>
             <li><a href="../fur.html">Fur Patterns</a></li>
             <li><a href="../flocking.html">Flocking</a></li>
             <li><a href="../flocking_categorical.html">Categorical Criteria</a></li>
             <li><a href="../flocking_sampling.html">Latin Hypercube Sampling</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="../sensitivity" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Sensitivity Analysis & Optimization<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">Sensitivity Analysis</li>
             <li><a href="../flocking_sens_lhs.html">Random Sampling</a></li>
             <li><a href="../flocking_sens_oat.html">One-at-a-time</a></li>
             <li><a href="../flocking_fast.html">FAST method</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Optimization</li>
             <li><a href="../flocking_bestfit.html">Best-fit Criterion</a></li>
             <li><a href="../flocking_random_search.html">Random Search</a></li>
             <li><a href="../flocking_bfgs.html">Optimization with L-BFGS-B</a></li>
             <li><a href="../flocking_nm.html">Nelder-Mead Optimization</a></li>
             <li><a href="../flocking_sa.html">Simulated Annealing</a></li>
             <li><a href="../flocking_ga.html">Genetic Algorithm</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="../help/index.html">Docs</a></li>
        <li><a href="https://github.com/bergant/nlexperiment">GitHub</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

  <table width="100%" summary="page for nl_eval_run">
    <tr>
      <td>nl_eval_run</td>
      <td style="text-align: right;">R Documentation</td>
    </tr>
  </table>
  <h2>Evaluate experiment with specific parameters</h2>
  <h3>Description</h3>
  <p>Function <code>nl_eval_run</code> runs experiment as
with <code>nl_run</code> but requires started NetLogo instance
with loaded model.
</p>
  <p>Function <code>nl_eval_init</code> starts NetLogo instance and
loads the NetLogo model. When using parallel version it initializes several
processes and returns cluster objects
</p>
  <p>Function <code>nl_eval_close</code> stops NetLogo instance
</p>
  <p>Function <code>nl_get_eval_fun</code> returns a function
wich calls <code>nl_eval_run</code> but does not need
additional parameters.
</p>
  <h3>Usage</h3>
  <pre>
nl_eval_run(param_set, experiment, criteria = NULL, print_progress = FALSE,
  call_back = NULL, parallel = FALSE, cluster = NULL,
  param_names = NULL)

nl_eval_init(experiment, parallel = FALSE, max_cores = NULL)

nl_eval_close(parallel = FALSE, cluster = NULL)

nl_get_eval_fun(experiment, param_names, parallel = FALSE, cluster = NULL,
  criteria, call_back = NULL)
</pre>
  <h3>Arguments</h3>
  <table summary="R argblock">
    <tr valign="top">
      <td>
        <code>param_set</code>
      </td>
      <td>
        <p>parameter set (a list of parameters with values)</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>experiment</code>
      </td>
      <td>
        <p>NetLogo experiment object (see <code>nl_experiment</code>)</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>criteria</code>
      </td>
      <td>
        <p>Which experiment evaluation criteria to be returned</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>print_progress</code>
      </td>
      <td>
        <p>print evaluation progress</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>call_back</code>
      </td>
      <td>
        <p>A call-back function for tracing result in optimization
processes</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>parallel</code>
      </td>
      <td>
        <p>If TRUE nl_eval_init returns cluster object which should be
passed to nl_eval_run and nl_eval_close.</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>cluster</code>
      </td>
      <td>
        <p>Required for parallel execution (nl_eval_init returns
cluster object)</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>param_names</code>
      </td>
      <td>
        <p>parameter names for parameter set</p>
      </td>
    </tr>
    <tr valign="top">
      <td>
        <code>max_cores</code>
      </td>
      <td>
        <p>If not defined all available cores are used.</p>
      </td>
    </tr>
  </table>
  <h3>Details</h3>
  <p>Use <code>nl_eval_run</code> when parameter set depend on previous evaluation
(parameter fitting / callibration / optimization methods).
It can use the same experiment object as <code>nl_run</code> function.
Evaluation criteria should be defined.
(see <code>nl_experiment</code> or <code>nl_set_measures</code>).
</p>
  <h3>Examples</h3>
  <pre>
## Not run: 

  experiment &lt;- nl_experiment(
    model_file = "models/Sample Models/Biology/Flocking.nlogo",

    setup_commands = c("setup", "repeat 100 [go]"),
    iterations = 5,

    param_values = list(
      world_size = 50,
      population = 80,
      vision = 6,
      min_separation = seq(from = 0, to = 4, by = 0.5),
      max_align_turn = seq(from = 0, to = 20, by = 2.5)
    ),
    mapping = c(
      min_separation = "minimum-separation",
      max_align_turn = "max-align-turn"),

    step_measures = measures(
      converged = "1 -
      (standard-deviation [dx] of turtles +
      standard-deviation [dy] of turtles) / 2",
      mean_crowding =
        "mean [count flockmates + 1] of turtles"
    ),
    eval_criteria = criteria(
      c_converged = mean(step$converged),
      c_mcrowding = mean(step$mean_crowding)
    ),

    repetitions = 10,                 # repeat simulations 10 times

    eval_aggregate_fun = mean,        # aggregate over repetitions

    eval_mutate = criteria(           # evaluation criterium
      eval_value =
        sqrt((c_mcrowding - 8)^2 + 400*(c_converged - 1)^2)
    )
 )

 library(dfoptim)

 cl &lt;- nl_eval_init(experiment, parallel = TRUE)
 trace &lt;- nl_eval_tracer(verbose = FALSE)
 param_range &lt;- nl_get_param_range(experiment)
 set.seed(1)

 o_result &lt;- nmkb(
   par = (param_range$upper + param_range$lower)/2,
   fn = nl_eval_run,
     experiment = experiment,
     criteria = "eval_value",
     call_back = trace$add,
     parallel = TRUE, cluster = cl,
     param_names = names(param_range$lower),
   lower = param_range$lower,
   upper = param_range$upper,
   control = list(maxfeval = 200)
 )
 nl_eval_close(parallel = TRUE, cl)

## End(Not run)
</pre>
</body>
<footer>
  <a href="../about.html">Authors</a> |
  View project on <a href="https://github.com/bergant/nlexperiment">GitHub</a> |
  Report <a href="https://github.com/bergant/nlexperiment/issues">Issues</a>
</footer>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
