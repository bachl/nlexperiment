<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Genetic Algorithm</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/default.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="tufterhandout2.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header navbar-left">
      <!--a class="navbar-brand" href="index.html">nlexperiment</a-->
      <a class="navbar-brand" href="index.html">
        <!--img class="img-responsive" src="img/logo.png"-->
        <strong><nl>nl</nl><experiment>experiment</experiment></strong>
      </a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="tutorial" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Tutorial <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li><a href="tutorial.html">Overview</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Getting started</li>
             <li><a href="fire.html">Fire Experiment</a></li>
             <li><a href="agents.html">Agents and Patches</a></li>
             <li><a href="ants.html">Ants</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Parameter Sets</li>
             <li><a href="fur.html">Fur Patterns</a></li>
             <li><a href="flocking.html">Flocking</a></li>
             <li><a href="flocking_categorical.html">Categorical Criteria</a></li>
             <li><a href="flocking_sampling.html">Latin Hypercube Sampling</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Optimization</li>
             <li><a href="flocking_bestfit.html">Best-fit Criterion</a></li>
             <li><a href="flocking_random_search.html">Random Search</a></li>
             <li><a href="flocking_bfgs.html">Optimization with L-BFGS-B</a></li>
             <li><a href="flocking_nm.html">Nelder-Mead Optimization</a></li>
             <li><a href="flocking_sa.html">Simulated Annealing</a></li>
             <li><a href="flocking_ga.html">Genetic Algorithm</a></li>
          </ul>
        </li>
        <li><a href="help/index.html">Package documentation</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
         <li><a href="https://github.com/bergant/nlexperiment">GitHub</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">
<h1 class="title">Genetic Algorithm</h1>
</div>


<p>This example is using NetLogo Flocking model (Wilensky, 1998) to demonstrate parameter fitting with genetic algorithms.</p>
<aside>
Wilensky, U. (1998). <a href="http://ccl.northwestern.edu/netlogo/models/Flocking">NetLogo Flocking model</a>. Center for Connected Learning and Computer-Based Modeling, Northwestern University, Evanston, IL.
</aside>
<p>There are many R packages for solving optimization problems (see <a href="https://cran.rstudio.com/web/views/Optimization.html">CRAN Task View</a>). This example uses <strong>rbga</strong> function from <strong>genalg</strong> package. See also Thiele, Kurth &amp; Grimm (2014) chapter <a href="http://jasss.soc.surrey.ac.uk/17/3/11.html#sectionEGA">2.35 Evolutionary or genetic algorithms</a>.</p>
<aside>
<p>Egon Willighagen and Michel Ballings (2015). genalg: R Based Genetic Algorithm. R package version 0.2.0. <a href="http://CRAN.R-project.org/package=genalg" class="uri">http://CRAN.R-project.org/package=genalg</a></p>
<p>Thiele, J. C., Kurth, W., &amp; Grimm, V. (2014). Facilitating Parameter Estimation and Sensitivity Analysis of Agent-Based Models: A Cookbook Using NetLogo and R. Journal of Artificial Societies and Social Simulation, 17(3), 11. <a href="http://jasss.soc.surrey.ac.uk/17/3/11.html" class="uri">http://jasss.soc.surrey.ac.uk/17/3/11.html</a></p>
</aside>
<p>Experiment definition is the same as in <a href="flocking_bfgs.html">L-BFGS-B Optimization</a> example:</p>
<p><lside><span class="glyphicon glyphicon-list-alt" aria-hidden="true" title="Define the experiment" style="color:gray"></span></lside></p>
<pre class="r"><code>experiment &lt;- nl_experiment( 
  model_file = &quot;models/Sample Models/Biology/Flocking.nlogo&quot;,

  setup_commands = c(&quot;setup&quot;, &quot;repeat 100 [go]&quot;),
  iterations = 5,

  param_values = list(
    world_size = 50,
    population = 80,
    vision = 6,
    min_separation = seq(from = 0, to = 4, by = 0.5),
    max_align_turn = seq(from = 0, to = 20, by = 2.5)
  ),
  mapping = c(
    min_separation = &quot;minimum-separation&quot;,
    max_align_turn = &quot;max-align-turn&quot;),

  step_measures = measures(
    converged = &quot;1 - 
      (standard-deviation [dx] of turtles + 
       standard-deviation [dy] of turtles) / 2&quot;,
    mean_crowding = 
      &quot;mean [count flockmates + 1] of turtles&quot;
  ),
  eval_criteria = criteria(
    c_converged = mean(step$converged),
    c_mcrowding = mean(step$mean_crowding)
  ),

  repetitions = 10,                 # repeat simulations 10 times

  eval_aggregate_fun = mean,        # aggregate over repetitions

  eval_mutate = criteria(           # evaluation criterium
    eval_value = 
      sqrt((c_mcrowding - 8)^2 + 400*(c_converged - 1)^2)
  )
)</code></pre>
<p>In this example the <code>nl_get_eval_fun</code> function is used to get the evaluation function used instead of evaluating with <code>nl_run</code>.</p>
<p>Note that this kind of evaluation requires started NetLogo instance. User have to take care to initialize NetLogo and load the model before optimization begins and close NetLogo when it is no longer needed (see <code>nl_eval_init</code> and <code>nl_eval_close</code> in package documentation).</p>
<p><lside><span class="glyphicon glyphicon-play-circle" aria-hidden="true" title="Run genalg::rbga" style="color:gray"></span></lside></p>
<pre class="r"><code>library(genalg) 

cl &lt;- nl_eval_init(experiment, parallel = TRUE)

param_range &lt;- nl_get_param_range(experiment)   
set.seed(1) 

eval_fun &lt;- nl_get_eval_fun(
  experiment = experiment, 
  param_names = names(param_range$lower),
  criteria = &quot;eval_value&quot;, 
  parallel = TRUE, 
  cluster = cl )

monitor_data &lt;- list()
monitor &lt;- function(obj) {
    monitor_data[[obj$iter]] &lt;&lt;- obj
}

result &lt;-
  genalg::rbga(
    stringMin = param_range$lower, 
    stringMax = param_range$upper, 
    popSize = 10, 
    evalFunc = eval_fun,
    iters = 9,
    monitorFunc = monitor
  )

nl_eval_close(parallel = TRUE, cl)</code></pre>
<aside>
See <a href="http://www.inside-r.org/packages/cran/genalg/docs/rbga">rbga</a> documentation to set genetic algorithm parameters for your needs.
</aside>
<p><lside><span class="glyphicon glyphicon-stats" aria-hidden="true" title="Plot evaluation progress" style="color:gray"></span></lside></p>
<pre class="r"><code>library(genalg)
plot(result)</code></pre>
<p>
<img src="img/pages-flockGAPlot1-1.png">
<aside>
<p class="caption">
Genetic algorithm progressing over generations
</p>
</aside>
</p>
<p><lside><span class="glyphicon glyphicon-stats" aria-hidden="true" title="Plot results" style="color:gray"></span></lside></p>
<pre class="r"><code>plot_monitor &lt;- function(obj) {
  xlim = c(obj$stringMin[1], obj$stringMax[1]);
  ylim = c(obj$stringMin[2], obj$stringMax[2]);
  plot(obj$population, xlim=xlim, ylim=ylim, 
       main = paste(&quot;Iteration: &quot;,obj$iter), 
       xlab = names(param_range$lower)[1], 
       ylab = names(param_range$lower)[2]);
}

op &lt;- par(mfrow = c(3,3))
for(obj in monitor_data)
  plot_monitor(obj)
par(op)</code></pre>
<p>
<img src="img/pages-flockGAPlot2-1.png">
<aside>
<p class="caption">
Generations in separate plots
</p>
</aside>
</p>
<div id="related" class="section level2">
<h2>Related</h2>
<p><a href="flocking_sa.html">Simulated Annealing</a> demonstrates optimization with simulated annealing.</p>
<p><a href="flocking_bfgs.html">L-BFGS-B Optimization</a> shows how to use optimization functions from other R packages.</p>
<p><a href="flocking_random_search.html">Random Search</a> demonstrates searching for optimal parameters using random search.</p>
<p><asideclose> Get <a href="flocking_ga.rmd">rmarkdown source</a> of this page. </asideclose></p>
</div>


<footer>
  <a href="about.html">Authors</a> |
  View project on <a href="https://github.com/bergant/nlexperiment">GitHub</a> |
  Report <a href="https://github.com/bergant/nlexperiment/issues">Issues</a>
</footer>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
